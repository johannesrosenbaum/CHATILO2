# CHATILO Production Deployment Guide

Dieser Guide erklärt, wie CHATILO auf einem Ubuntu-Server für https://www.chatilo.de deployed wird.

## 🚀 Schnellstart

### 1. Voraussetzungen

- Ubuntu Server (18.04 oder höher)
- Root-Zugriff oder sudo-Berechtigungen
- Domain: chatilo.de (DNS auf Server-IP zeigen)
- GitHub Repository: https://github.com/johannesrosenbaum/CHATILO2.git

### 2. Erste Installation

```bash
# Auf dem Ubuntu Server ausführen:
sudo su
wget https://raw.githubusercontent.com/johannesrosenbaum/CHATILO2/main/deploy-to-production.sh
chmod +x deploy-to-production.sh
./deploy-to-production.sh
```

### 3. Konfiguration anpassen

Vor dem Deployment die folgenden Werte in `deploy-to-production.sh` anpassen:

```bash
SSL_EMAIL="deine-email@example.com"  # Deine E-Mail für SSL-Zertifikate
```

## 📁 Deployment-Struktur

```
/var/www/chatilo/           # Hauptverzeichnis
├── client/                 # React Frontend
├── server/                 # Node.js Backend
├── server/uploads/         # Upload-Verzeichnisse
│   ├── avatars/           # Profilbilder
│   ├── images/            # Chat-Bilder
│   ├── videos/            # Chat-Videos
│   └── files/             # Andere Dateien
├── ecosystem.config.js     # PM2 Konfiguration
└── .env                   # Umgebungsvariablen
```

## 🌐 Domain-Konfiguration

Das Deployment erstellt folgende Domains:

- **https://www.chatilo.de** - Hauptwebsite (Frontend)
- **https://api.chatilo.de** - API-Endpunkt
- **https://chatilo.de** - Weiterleitung zu www.chatilo.de

## 🔧 Services

### PM2 (Process Manager)
```bash
# Status anzeigen
pm2 status

# Logs anzeigen
pm2 logs chatilo-server

# Neustart
pm2 restart chatilo-server

# Stoppen
pm2 stop chatilo-server
```

### Nginx (Web Server)
```bash
# Konfiguration testen
nginx -t

# Neuladen
systemctl reload nginx

# Status
systemctl status nginx
```

### MongoDB (Datenbank)
```bash
# Status
systemctl status mongod

# Neustart
systemctl restart mongod
```

## 🔄 Updates

Für zukünftige Updates:

```bash
# Update-Script herunterladen
wget https://raw.githubusercontent.com/johannesrosenbaum/CHATILO2/main/update-production.sh
chmod +x update-production.sh

# Update ausführen
sudo ./update-production.sh
```

## 📊 Monitoring

### Logs anzeigen
```bash
# PM2 Logs
pm2 logs chatilo-server

# Nginx Logs
tail -f /var/log/nginx/access.log
tail -f /var/log/nginx/error.log

# Anwendungs-Logs
tail -f /var/log/chatilo/combined.log
```

### Status-Checks
```bash
# Website erreichbar?
curl -I https://www.chatilo.de

# API erreichbar?
curl -I https://api.chatilo.de

# SSL-Zertifikat gültig?
certbot certificates
```

## 🔒 SSL-Zertifikate

SSL-Zertifikate werden automatisch von Let's Encrypt erstellt und erneuert:

```bash
# Manuelle Erneuerung
certbot renew

# Status prüfen
certbot certificates
```

## 🛠️ Troubleshooting

### Website nicht erreichbar
```bash
# Nginx Status prüfen
systemctl status nginx

# PM2 Status prüfen
pm2 status

# Logs prüfen
pm2 logs chatilo-server
```

### SSL-Probleme
```bash
# Zertifikat erneuern
certbot renew --force-renewal

# Nginx neu laden
systemctl reload nginx
```

### Datenbank-Probleme
```bash
# MongoDB Status
systemctl status mongod

# MongoDB starten
systemctl start mongod
```

## 📝 Umgebungsvariablen

Wichtige Umgebungsvariablen in `/var/www/chatilo/.env`:

```bash
NODE_ENV=production
PORT=1113
MONGODB_URI=mongodb://localhost:27017/chatilo
JWT_SECRET=<auto-generated>
SOCKET_URL=https://api.chatilo.de
CLIENT_URL=https://www.chatilo.de
```

## 🔐 Sicherheit

- SSL/TLS Verschlüsselung aktiviert
- Security Headers konfiguriert
- CORS für erlaubte Domains
- Datei-Upload-Limits gesetzt
- PM2 für Prozess-Management

## 📞 Support

Bei Problemen:

1. Logs prüfen: `pm2 logs chatilo-server`
2. Status prüfen: `pm2 status`
3. Nginx testen: `nginx -t`
4. SSL prüfen: `certbot certificates`

## 🎯 Deployment-Checkliste

- [ ] Domain DNS auf Server-IP zeigen
- [ ] Server Root-Zugriff haben
- [ ] GitHub Repository existiert
- [ ] SSL-E-Mail-Adresse konfiguriert
- [ ] Deployment-Script ausgeführt
- [ ] Website erreichbar unter https://www.chatilo.de
- [ ] API erreichbar unter https://api.chatilo.de
- [ ] SSL-Zertifikate gültig
- [ ] PM2 läuft
- [ ] Nginx läuft
- [ ] MongoDB läuft 
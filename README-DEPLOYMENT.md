# CHATILO Production Deployment Guide

Dieser Guide erklÃ¤rt, wie CHATILO auf einem Ubuntu-Server fÃ¼r https://www.chatilo.de deployed wird.

## ğŸš€ Schnellstart

### 1. Voraussetzungen

- Ubuntu Server (18.04 oder hÃ¶her)
- Root-Zugriff oder sudo-Berechtigungen
- Domain: chatilo.de (DNS auf Server-IP zeigen)
- GitHub Repository: https://github.com/johannesrosenbaum/CHATILO2.git

### 2. Erste Installation

```bash
# Auf dem Ubuntu Server ausfÃ¼hren:
sudo su
wget https://raw.githubusercontent.com/johannesrosenbaum/CHATILO2/main/deploy-to-production.sh
chmod +x deploy-to-production.sh
./deploy-to-production.sh
```

### 3. Konfiguration anpassen

Vor dem Deployment die folgenden Werte in `deploy-to-production.sh` anpassen:

```bash
SSL_EMAIL="deine-email@example.com"  # Deine E-Mail fÃ¼r SSL-Zertifikate
```

## ğŸ“ Deployment-Struktur

```
/var/www/chatilo/           # Hauptverzeichnis
â”œâ”€â”€ client/                 # React Frontend
â”œâ”€â”€ server/                 # Node.js Backend
â”œâ”€â”€ server/uploads/         # Upload-Verzeichnisse
â”‚   â”œâ”€â”€ avatars/           # Profilbilder
â”‚   â”œâ”€â”€ images/            # Chat-Bilder
â”‚   â”œâ”€â”€ videos/            # Chat-Videos
â”‚   â””â”€â”€ files/             # Andere Dateien
â”œâ”€â”€ ecosystem.config.js     # PM2 Konfiguration
â””â”€â”€ .env                   # Umgebungsvariablen
```

## ğŸŒ Domain-Konfiguration

Das Deployment erstellt folgende Domains:

- **https://www.chatilo.de** - Hauptwebsite (Frontend)
- **https://api.chatilo.de** - API-Endpunkt
- **https://chatilo.de** - Weiterleitung zu www.chatilo.de

## ğŸ”§ Services

### PM2 (Process Manager)
```bash
# Status anzeigen
pm2 status

# Logs anzeigen
pm2 logs chatilo-server

# Neustart
pm2 restart chatilo-server

# Stoppen
pm2 stop chatilo-server
```

### Nginx (Web Server)
```bash
# Konfiguration testen
nginx -t

# Neuladen
systemctl reload nginx

# Status
systemctl status nginx
```

### MongoDB (Datenbank)
```bash
# Status
systemctl status mongod

# Neustart
systemctl restart mongod
```

## ğŸ”„ Updates

FÃ¼r zukÃ¼nftige Updates:

```bash
# Update-Script herunterladen
wget https://raw.githubusercontent.com/johannesrosenbaum/CHATILO2/main/update-production.sh
chmod +x update-production.sh

# Update ausfÃ¼hren
sudo ./update-production.sh
```

## ğŸ“Š Monitoring

### Logs anzeigen
```bash
# PM2 Logs
pm2 logs chatilo-server

# Nginx Logs
tail -f /var/log/nginx/access.log
tail -f /var/log/nginx/error.log

# Anwendungs-Logs
tail -f /var/log/chatilo/combined.log
```

### Status-Checks
```bash
# Website erreichbar?
curl -I https://www.chatilo.de

# API erreichbar?
curl -I https://api.chatilo.de

# SSL-Zertifikat gÃ¼ltig?
certbot certificates
```

## ğŸ”’ SSL-Zertifikate

SSL-Zertifikate werden automatisch von Let's Encrypt erstellt und erneuert:

```bash
# Manuelle Erneuerung
certbot renew

# Status prÃ¼fen
certbot certificates
```

## ğŸ› ï¸ Troubleshooting

### Website nicht erreichbar
```bash
# Nginx Status prÃ¼fen
systemctl status nginx

# PM2 Status prÃ¼fen
pm2 status

# Logs prÃ¼fen
pm2 logs chatilo-server
```

### SSL-Probleme
```bash
# Zertifikat erneuern
certbot renew --force-renewal

# Nginx neu laden
systemctl reload nginx
```

### Datenbank-Probleme
```bash
# MongoDB Status
systemctl status mongod

# MongoDB starten
systemctl start mongod
```

## ğŸ“ Umgebungsvariablen

Wichtige Umgebungsvariablen in `/var/www/chatilo/.env`:

```bash
NODE_ENV=production
PORT=1113
MONGODB_URI=mongodb://localhost:27017/chatilo
JWT_SECRET=<auto-generated>
SOCKET_URL=https://api.chatilo.de
CLIENT_URL=https://www.chatilo.de
```

## ğŸ” Sicherheit

- SSL/TLS VerschlÃ¼sselung aktiviert
- Security Headers konfiguriert
- CORS fÃ¼r erlaubte Domains
- Datei-Upload-Limits gesetzt
- PM2 fÃ¼r Prozess-Management

## ğŸ“ Support

Bei Problemen:

1. Logs prÃ¼fen: `pm2 logs chatilo-server`
2. Status prÃ¼fen: `pm2 status`
3. Nginx testen: `nginx -t`
4. SSL prÃ¼fen: `certbot certificates`

## ğŸ¯ Deployment-Checkliste

- [ ] Domain DNS auf Server-IP zeigen
- [ ] Server Root-Zugriff haben
- [ ] GitHub Repository existiert
- [ ] SSL-E-Mail-Adresse konfiguriert
- [ ] Deployment-Script ausgefÃ¼hrt
- [ ] Website erreichbar unter https://www.chatilo.de
- [ ] API erreichbar unter https://api.chatilo.de
- [ ] SSL-Zertifikate gÃ¼ltig
- [ ] PM2 lÃ¤uft
- [ ] Nginx lÃ¤uft
- [ ] MongoDB lÃ¤uft 